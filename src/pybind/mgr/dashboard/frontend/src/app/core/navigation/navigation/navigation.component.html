<!-- ************************ -->
<!-- HEADER  -->
<!-- ************************ -->
<ng-template #header>
<cds-header name="Ceph Dashboard">
  <cds-hamburger [active]="showMenuSidebar" (selected)="showMenuSidebar = !showMenuSidebar"></cds-hamburger>
  
  <cds-header-global>
    <cds-header-navigation>
      <cd-language-selector class="d-flex"></cd-language-selector>
    </cds-header-navigation>
    <cds-header-action>
      <cd-notifications (click)="toggleRightSidebar()"></cd-notifications>
    </cds-header-action>
      <cds-header-action><cd-dashboard-help></cd-dashboard-help></cds-header-action>
    <cds-header-action><cd-administration></cd-administration></cds-header-action>
    <cds-header-action><cd-identity></cd-identity></cds-header-action>
  </cds-header-global>
</cds-header>
</ng-template>

<!-- ************************ -->
<!-- NOTIFICATIONS/ALERTS  -->
<!-- ************************ -->
<cd-pwd-expiration-notification></cd-pwd-expiration-notification>
<cd-telemetry-notification></cd-telemetry-notification>
<cd-motd></cd-motd>
<cd-notifications-sidebar></cd-notifications-sidebar>
<!-- ************************ -->
<!-- OLD TOP NAVBAR -->
<!-- ************************ -->
<!-- <div class="cd-navbar-top">
  <nav class="navbar navbar-expand-md navbar-dark cd-navbar-brand">
    <button class="btn btn-link py-0"
            (click)="showMenuSidebar = !showMenuSidebar"
            aria-label="toggle sidebar visibility">
      <i [ngClass]="[icons.bars, icons.large2x]"
          aria-hidden="true"></i>
    </button>

    <a class="navbar-brand ms-2"
        routerLink="/dashboard">
      <img src="assets/Ceph_Ceph_Logo_with_text_white.svg"
            alt="Ceph" />
    </a>

    <button type="button"
            class="navbar-toggler"
            (click)="toggleRightSidebar()">
      <span i18n
            class="sr-only">Toggle navigation</span>
      <span>
        <i [ngClass]="[icons.navicon, icons.large]"></i>
      </span>
    </button>

    <div class="collapse navbar-collapse"
          [ngClass]="{'show': rightSidebarOpen}">
      <ng-container *ngIf="clustersMap?.size > 1">
        <div ngbDropdown
              placement="bottom-left"
              class="d-inline-block ms-5">
          <button ngbDropdownToggle
                  class="btn btn-outline-light cd-context-bar"
                  i18n-title
                  title="Selected Cluster:">
            <span class="dropdown-text"> {{ selectedCluster?.name }} </span>
            <span>- {{ selectedCluster?.cluster_alias }} - {{ selectedCluster?.user }}</span>
          </button>
          <div ngbDropdownMenu>
            <ng-container *ngFor="let cluster of clustersMap | keyvalue">
              <button ngbDropdownItem
                      (click)="onClusterSelection(cluster.value)"
                      [disabled]="cluster.value.cluster_connection_status === 1">
                <div class="dropdown-text">{{ cluster.value.name }}</div>
                <div *ngIf="cluster.value.cluster_alias"
                      class="text-secondary">{{ cluster.value.cluster_alias }} - {{ cluster.value.user }}</div>
              </button>
            </ng-container>
          </div>
        </div>
      </ng-container>
      <ul class="nav navbar-nav cd-navbar-utility my-2 my-md-0">
        <ng-container *ngTemplateOutlet="cd_utilities"> </ng-container>
      </ul>
    </div>
  </nav>
</div> -->

<!-- ************************ -->
<!-- WRAPPER AROUND SIDENAV AND MAIN CONTAINT -->
<!-- ************************ -->
<ng-container *ngTemplateOutlet="header"></ng-container>
<div class="wrapper">
  <!-- Content -->
  <nav id="sidebar"
        [ngClass]="{'active': !showMenuSidebar}">
    <ng-container *ngTemplateOutlet="cd_menu"></ng-container>
  </nav>

  <!-- Page Content -->
  <div id="content"
        [ngClass]="{'active': !showMenuSidebar}">
    <ng-content></ng-content>
  </div>
</div>

<!-- ************************ -->
<!-- TODO: SHOULD INTEGRATE THIS INTO CURRENT HEADER NAV -->
<!-- ************************ -->
<ng-template #cd_utilities>
  <li class="nav-item">
    <cd-language-selector class="cd-navbar"></cd-language-selector>
  </li>
  <li class="nav-item">
    <cd-notifications class="cd-navbar"
                      (click)="toggleRightSidebar()"></cd-notifications>
  </li>
  <li class="nav-item">
    <cd-dashboard-help class="cd-navbar"></cd-dashboard-help>
  </li>
  <li class="nav-item">
    <cd-administration class="cd-navbar"></cd-administration>
  </li>
  <li class="nav-item">
    <cd-identity class="cd-navbar"></cd-identity>
  </li>
</ng-template>

<!-- ************************ -->
<!-- SIDENAV -->
<!-- ************************ -->
<ng-template #cd_menu>
  <ng-container *ngIf="enabledFeature$ | async as enabledFeature">
  <div cdsTheme="theme">
    <cds-sidenav [expanded]="showMenuSidebar" class="mt-5">
      <!-- Dashboard -->
      <cds-sidenav-item route="/dashboard" [useRouter]="true">
        <svg cdsIcon="template" icon size="20"></svg>
        <span i18n>
          Dashboard</span>
      </cds-sidenav-item>
      <!-- Multi-cluster Dashboard -->
      <cds-sidenav-menu title="Multi-Cluster">
        <svg cdsIcon="edge-cluster" icon size="20"></svg>
        <cds-sidenav-item route="/multi-cluster/overview" [useRouter]="true"><span i18n >Overview</span></cds-sidenav-item>
        <cds-sidenav-item route="/multi-cluster/manage-clusters" [useRouter]="true"><span i18n >Manager Cluster</span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Cluster -->
      <cds-sidenav-menu title="Cluster" *ngIf="permissions.hosts.read || permissions.monitor.read ||
      permissions.osd.read || permissions.pool.read">
        <svg cdsIcon="web-services--cluster" icon size="20"></svg>
        <cds-sidenav-item route="/pool" [useRouter]="true" *ngIf="permissions.pool.read"><span i18n >Pools</span></cds-sidenav-item>
        <cds-sidenav-item route="/hosts" [useRouter]="true" *ngIf="permissions.hosts.read"><span i18n >Hosts</span></cds-sidenav-item>
        <cds-sidenav-item route="/osd" [useRouter]="true" *ngIf="permissions.osd.read"><span i18n >OSDs</span></cds-sidenav-item>
        <cds-sidenav-item route="/inventory" [useRouter]="true" *ngIf="permissions.hosts.read"><span i18n >Physical Disks</span></cds-sidenav-item>
        <cds-sidenav-item route="/crush-map" [useRouter]="true" *ngIf="permissions.osd.read"><span i18n>CRUSH Map</span></cds-sidenav-item>
        <cds-sidenav-item route="/monitor" [useRouter]="true" *ngIf="permissions.monitor.read"><span i18n >Monitors</span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Block Storage -->
      <cds-sidenav-menu title="Block" *ngIf="(permissions.rbdImage.read || permissions.rbdMirroring.read|| permissions.iscsi.read) && (enabledFeature.rbd || enabledFeature.mirroring || enabledFeature.iscsi)">
        <svg cdsIcon="datastore" icon size="20"></svg>
        <cds-sidenav-item route="/block/rbd" [useRouter]="true" *ngIf="permissions.rbdImage.read && enabledFeature.rbd"><span i18n>Images</span></cds-sidenav-item>
        <cds-sidenav-item route="/block/mirroring" [useRouter]="true" *ngIf="permissions.rbdMirroring.read && enabledFeature.mirroring"><span i18n>Mirroring
          <small *ngIf="summaryData?.rbd_mirroring?.warnings !== 0"
                    class="badge badge-warning">{{ summaryData?.rbd_mirroring?.warnings }}</small>
            <small *ngIf="summaryData?.rbd_mirroring?.errors !== 0"
                    class="badge badge-danger">{{ summaryData?.rbd_mirroring?.errors }}</small>
        </span></cds-sidenav-item>
        <cds-sidenav-item route="/block/iscsi" [useRouter]="true" *ngIf="permissions.iscsi.read && enabledFeature.iscsi"><span i18n>iSCSI</span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Object Storage -->
      <cds-sidenav-menu title="Object" *ngIf="permissions.rgw.read && enabledFeature.rgw">
        <svg cdsIcon="object-storage" icon size="20"></svg>
        <cds-sidenav-item route="/rgw/overview" [userouter]="true"><span i18n>Overview</span></cds-sidenav-item>
        <cds-sidenav-item route="/rgw/bucket" [userouter]="true"><span i18n>Buckets</span></cds-sidenav-item>
        <cds-sidenav-item route="/rgw/user" [userouter]="true"><span i18n>Users</span></cds-sidenav-item>
        <cds-sidenav-item route="/rgw/multisite" [userouter]="true"><span i18n>Multi-site</span></cds-sidenav-item>
        <cds-sidenav-item route="/rgw/daemon" [userouter]="true"><span i18n>Gateways</span></cds-sidenav-item>
        <cds-sidenav-item route="/nfs" [useRouter]="true" *ngIf="permissions.nfs.read && enabledFeature.nfs"><span i18n>NFS</span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Filesystem -->
      <cds-sidenav-menu title="File" *ngIf="permissions.nfs.read && enabledFeature.nfs || permissions.cephfs.read && enabledFeature.cephfs">
        <svg cdsIcon="file-storage" icon size="20"></svg>
        <cds-sidenav-item route="/cephfs" [useRouter]="true" *ngIf="permissions.cephfs.read && enabledFeature.cephfs"><span i18n>File Systems</span></cds-sidenav-item>
        <cds-sidenav-item route="/nfs" [useRouter]="true" *ngIf="permissions.nfs.read && enabledFeature.nfs"><span i18n>NFS</span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Observability -->
      <cds-sidenav-menu title="Observability" *ngIf="permissions.log.read || permissions.prometheus.read">
        <svg cdsIcon="observed--hail" icon size="20"></svg>
        <cds-sidenav-item route="/logs" [useRouter]="true" *ngIf="permissions.log.read"><span i18n>Logs</span></cds-sidenav-item>
        <cds-sidenav-item route="/monitoring" [useRouter]="true" *ngIf="permissions.log.read"><span i18n>
          <ng-container>Alerts</ng-container>
              <small *ngIf="prometheusAlertService.activeCriticalAlerts > 0"
                    class="badge badge-danger ms-1">{{ prometheusAlertService.activeCriticalAlerts }}</small>
              <small *ngIf="prometheusAlertService.activeWarningAlerts > 0"
                    class="badge badge-warning ms-1">{{ prometheusAlertService.activeWarningAlerts }}</small>
        </span></cds-sidenav-item>
      </cds-sidenav-menu>
      <!-- Administration -->
      <cds-sidenav-menu title="Administration" *ngIf="permissions.configOpt.read || permissions.hosts.read">
        <svg cdsIcon="network--admin-control" icon size="20"></svg>
        <cds-sidenav-item route="/services/" [useRouter]="true" *ngIf="permissions.hosts.read"><span i18n>Services</span></cds-sidenav-item>
        <cds-sidenav-item route="/upgrade" [useRouter]="true" *ngIf="permissions.configOpt.read"><span i18n>Upgrade</span></cds-sidenav-item>
        <cds-sidenav-item route="/ceph-users" [useRouter]="true" *ngIf="permissions.configOpt.read"><span i18n>Ceph Users</span></cds-sidenav-item>
        <cds-sidenav-item route="/mgr-modules" [useRouter]="true" *ngIf="permissions.configOpt.read"><span i18n>Manager Modules</span></cds-sidenav-item>
        <cds-sidenav-item route="/configuration" [useRouter]="true" *ngIf="permissions.configOpt.read"><span i18n>Configuration</span></cds-sidenav-item>
      </cds-sidenav-menu>
    </cds-sidenav>        
  </div>
  </ng-container>
</ng-template>
